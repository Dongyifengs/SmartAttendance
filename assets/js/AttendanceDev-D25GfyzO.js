/* empty css                  *//* empty css                 *//* empty css                        */import{g as a,c as e,d as l,e as t,f as s}from"./index-ThND04tc.js";/* empty css                */import{i as r,r as o,h as n,o as i,j as u,k as d,m as c}from"./element-plus-tx2s2pn9.js";import{v as p,r as m,c as v,o as h,x as _,B as y,J as b,G as w,U as f,K as k,H as g,aa as j,a2 as D,O as S,y as x}from"./vue-vendor-CoPnbFnN.js";import{_ as N}from"./index-30FeaZnB.js";import"./utils-BuH06i2U.js";const Y={class:"attendance-page"},A={class:"header"},I={class:"user-info"},O={class:"mt-3"},U={class:"mt-5"},z=N(p({__name:"AttendanceDev",setup(p){const N=m(""),z=m(""),K=m([]),M=m(!1),C=m({1:[],2:[],3:[],4:[],5:[]}),E={1:"正常",2:"迟到",3:"早退",4:"旷课",5:"请假"},H=m(["2020-01-01",r().format("YYYY-MM-DD")]),J=()=>{try{const a=localStorage.getItem("SA-ZHKQ-USERINFO");return a&&JSON.parse(a).token||""}catch{return""}},V=(a,e,l)=>1===l?"是":"否",F=()=>M.value=!M.value,P=v(()=>{const a=K.value;return M.value||a.length<=4?a:[...a.slice(0,2),...a.slice(-2)]}),Q=async a=>{try{const e=J(),r=(()=>{try{const a=localStorage.getItem("SA-ZHKQ-USERINFO");return a&&JSON.parse(a).pk_user||""}catch{return""}})();if(!e||!r||!z.value)return;const o=await l(e,r,z.value,a,H.value[0],H.value[1]);o.list&&Array.isArray(o.list)&&(C.value[a]=await Promise.all(o.list.map(async l=>{let o=0,n="";try{const i=await t(e,z.value,l.pk_lesson,r,a,H.value[0],H.value[1]);o=i.list?.[0]?.totalNum||0;const u=await s(e,z.value,l.pk_lesson,r,a,H.value[0],H.value[1]);"1"===u.state&&u.data?.record_list?.length&&(n=u.data.record_list.map(a=>a.record_date).join("、"))}catch(i){}return{lesson_name:l.lesson_name,teacher_name:l.teacher_name,status:E[a]||"未知",totalNum:o,pk_lesson:l.pk_lesson,recordDates:n}})))}catch(e){}},R=async()=>{for(const a of["1","2","3","4","5"])await Q(a)};return h(async()=>{await(async()=>{const l=J();if(l)try{const t=await a(l),s=t.class_list?.[0];if(!s)return;N.value=s.class_name,z.value=s.class_id;const r=await e(l,s.class_id);K.value=r.group_members||[]}catch(t){}})(),await R()}),(a,e)=>{const l=o,t=n,s=i,r=d,p=u,m=c;return x(),_("div",Y,[y("div",A,[f(l,null,{default:k(()=>[...e[2]||(e[2]=[D("AttendanceDev - 考勤查询页面",-1)])]),_:1}),f(t,{class:"ml-2",type:"default",onClick:e[0]||(e[0]=e=>a.$router.back())},{default:k(()=>[...e[3]||(e[3]=[D("返回上一页",-1)])]),_:1})]),y("div",I,[f(l,null,{default:k(()=>[D("当前用户班级："+S(N.value||"加载中..."),1)]),_:1}),e[4]||(e[4]=y("br",null,null,-1)),f(l,null,{default:k(()=>[D("当前用户班级ID："+S(z.value||"加载中..."),1)]),_:1}),e[5]||(e[5]=y("br",null,null,-1))]),y("div",O,[f(s,{modelValue:H.value,"onUpdate:modelValue":e[1]||(e[1]=a=>H.value=a),"end-placeholder":"结束日期",format:"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期",type:"daterange"},null,8,["modelValue"]),f(t,{class:"ml-2",type:"primary",onClick:R},{default:k(()=>[...e[6]||(e[6]=[D("查询",-1)])]),_:1})]),K.value.length>4?(x(),b(t,{key:0,class:"mt-3 mb-2",size:"small",type:"primary",onClick:F},{default:k(()=>[D(S(M.value?"收起":"显示全部"),1)]),_:1})):w("",!0),K.value.length?(x(),b(p,{key:1,data:P.value,border:"",size:"small",stripe:"",style:{width:"100%"}},{default:k(()=>[f(r,{label:"学号",prop:"user_code",width:"120"}),f(r,{label:"姓名",prop:"user_name",width:"100"}),f(r,{label:"EAS ID","min-width":"200",prop:"easid"}),f(r,{label:"UserPK","min-width":"200",prop:"userpk"}),f(r,{formatter:V,label:"是否好友",prop:"is_friends",width:"100"}),f(r,{label:"性别",prop:"sex",width:"80"})]),_:1},8,["data"])):(x(),b(m,{key:2,class:"mt-5",description:"暂无学生信息"})),y("div",U,[(x(),_(g,null,j(["1","4","5"],a=>y("div",{key:a,class:"course-table"},[y("div",null,S(E[a])+"课程：",1),C.value[a].length?(x(),b(p,{key:0,data:C.value[a],border:"",size:"small",stripe:"",style:{width:"100%","margin-top":"5px"}},{default:k(()=>[f(r,{label:"课程名称","min-width":"200",prop:"lesson_name"}),f(r,{label:"教师名称","min-width":"150",prop:"teacher_name"}),f(r,{label:"考勤状态",prop:"status",width:"100"}),f(r,{label:"次数",prop:"totalNum",width:"80"}),f(r,{label:"日期","min-width":"220",prop:"recordDates"})]),_:2},1032,["data"])):(x(),b(m,{key:1,class:"mt-2",description:"暂无课程"}))])),64)),(x(),_(g,null,j(["2","3"],a=>y("div",{key:a,class:"course-table"},[y("div",null,S(E[a])+"课程：",1),C.value[a].length?(x(),b(p,{key:0,data:C.value[a],border:"",size:"small",stripe:"",style:{width:"100%","margin-top":"5px"}},{default:k(()=>[f(r,{label:"课程名称","min-width":"200",prop:"lesson_name"}),f(r,{label:"教师名称","min-width":"150",prop:"teacher_name"}),f(r,{label:"考勤状态",prop:"status",width:"100"}),f(r,{label:"次数",prop:"totalNum",width:"80"}),f(r,{label:"日期","min-width":"220",prop:"recordDates"})]),_:2},1032,["data"])):(x(),b(m,{key:1,class:"mt-2",description:"暂无课程"}))])),64))])])}}}),[["__scopeId","data-v-57615408"]]);export{z as default};
