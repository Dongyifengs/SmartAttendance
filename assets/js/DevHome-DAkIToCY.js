/* empty css                  *//* empty css                   */import{a as e,b as a,c as t,O as l,d as n,e as s,f as i,g as u,h as o}from"./index-DjBO542e.js";import{h as r,i as c,j as d,a as m,b as v}from"./index-ThND04tc.js";/* empty css                        *//* empty css                */import{i as f,b as g,s as _,t as p,w as y,u as h,x as w,y as b,z as k,h as S,A as I,a as C,B as O,v as x,C as N,j as $,k as T,d as D,e as H,r as M,D as A,F as U,G as R}from"./element-plus-tx2s2pn9.js";import{_ as V,r as B}from"./index-30FeaZnB.js";import{a as J}from"./utils-BuH06i2U.js";import{v as L,at as Y,r as z,c as j,w as E,x as F,B as K,O as q,U as G,K as P,a2 as Q,G as Z,u as W,J as X,y as ee,H as ae,aa as te,n as le,o as ne,D as se,R as ie}from"./vue-vendor-CoPnbFnN.js";const ue=J.create({baseURL:"http://moyijiangnan.cn:3000",headers:{"Content-Type":"application/json"}});async function oe(e,a,t,l,n,s){const i=function(){const e=localStorage.getItem("SA-CACHED-USER-INFO");if(!e)return null;try{return JSON.parse(e)}catch(a){return null}}();if(!i)return null;const u={name:e,ID:Number(i.studentId),time:f().format("YYYY-MM-DDTHH:mm:ssZ"),userName:i.studentName,data:{FuncName:a,Params:{RequestBody:t,ResponseBody:l,Metadata:{UserID:i.studentId,UserIP:i.userIp,Hash:n},return:s}}};return(await ue.post("/user/upload",u)).data}const re={class:"class-card-wrapper"},ce={class:"class-container"},de={class:"class-header"},me={class:"class-title"},ve={class:"class-index"},fe={class:"class-name"},ge={class:"status-tag"},_e={class:"class-content"},pe={class:"info-row-compact"},ye={class:"info-item-inline"},he={class:"info-item-inline"},we={class:"info-item-inline"},be={class:"sign-info"},ke={key:0,class:"sign-row"},Se={class:"sign-text"},Ie={key:1,class:"sign-row"},Ce={key:2,class:"sign-row"},Oe={key:0,class:"sign-info"},xe={key:0,class:"sign-row"},Ne={class:"sign-text"},$e={key:1,class:"sign-row"},Te=V(L({__name:"ClassCard",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const a=Y(e,"modelValue"),t=z(""),l=r(),n="f7ede28b",s=j(()=>a.value.computedStatus||(a.value.situation?null:"æœªç­¾åˆ°")),i=j(()=>{const e=f(),t=a.value.startTime.subtract(30,"minute");return e.isAfter(t)||e.isSame(t)}),u=j(()=>("è¿Ÿåˆ°"===a.value.situation||"è¿Ÿåˆ°"===s.value)&&!a.value.signInTime);E(u,e=>{if(e&&!t.value){const e=a.value.startTime.subtract(9,"minute");t.value=e.format("HH:mm")}},{immediate:!0});const o=j(()=>"å·²æ—·è¯¾"===a.value.situation?"danger":"è¿Ÿåˆ°"===a.value.situation||"æ—©é€€"===a.value.situation?"warning":"å·²è¯·å‡"===a.value.situation?"info":"å·²ç­¾é€€"===s.value?"success":"å·²ç­¾åˆ°"===s.value?"primary":"info"),m=async()=>{if(!l.value||!a.value.pk_anlaxy_syllabus_user)return void alert("âŒ ç¼ºå°‘å¿…è¦çš„ç­¾åˆ°ä¿¡æ¯");const e=f(),s=a.value.startTime;let i;const u=e.isAfter(s);if(u&&t.value)i=`${a.value.lessonDate} ${t.value}:00`;else if(u&&!t.value){i=s.subtract(9,"minute").format("YYYY-MM-DD HH:mm:ss")}else i=e.format("YYYY-MM-DD HH:mm:ss");const o=f(i),r=o.isAfter(s),d=r?Math.max(0,o.diff(s,"minute")):0,m={userKey:l.value.token,pk_anlaxy_syllabus_user:a.value.pk_anlaxy_syllabus_user,sign_in_type:2,u_begin_time:i,late_time_length:d,late_num:r?1:0,ask_leave_num:0,in_longitude:0,in_latitude:0,phone_code:l.value.client_id||""};try{const e=await c(m);if("1"===e.state){try{await oe("ç­¾åˆ°","zhkq_Click_SignIn",JSON.stringify(m),JSON.stringify(e),n,a.value.className)}catch(v){}alert(`âœ… ç­¾åˆ°æˆåŠŸï¼\n\nè¯¾ç¨‹: ${a.value.className}\nç­¾åˆ°æ—¶é—´: ${i}\nçŠ¶æ€: æ­£å¸¸ç­¾åˆ°`),window.location.reload()}else alert(`âš ï¸ ç­¾åˆ°å¤±è´¥\n\nstate: ${e.state}\nsing_result: ${e.sing_result}`)}catch(g){alert("âŒ ç­¾åˆ°å¤±è´¥\n\nç½‘ç»œé”™è¯¯æˆ–æœåŠ¡å™¨å¼‚å¸¸")}},v=async()=>{if(!l.value||!a.value.pk_anlaxy_syllabus_user||!a.value.signInTime)return void alert("âŒ ç¼ºå°‘å¿…è¦çš„ç­¾é€€ä¿¡æ¯æˆ–æœªç­¾åˆ°");const e=f(),t=a.value.endTime,s=e.isBefore(t)?1:2;if(1===s)try{await I.confirm(`å½“å‰æ—¶é—´: ${e.format("HH:mm")}ï¼Œè¯¾ç¨‹ç»“æŸæ—¶é—´: ${t.format("HH:mm")}<br>æ‚¨ç¡®å®šè¦åœ¨è¯¾ç¨‹ç»“æŸå‰ç­¾é€€å—ï¼Ÿ<br>è¿™å°†è®°å½•ä¸ºæ—©é€€ã€‚`,"âš ï¸ æ—©é€€æé†’",{confirmButtonText:"ç¡®å®šç­¾é€€",cancelButtonText:"å–æ¶ˆ",dangerouslyUseHTMLString:!0,type:"warning"})}catch(r){return}const i=e.format("HH:mm"),u=a.value.signInTime.format("YYYY-MM-DD HH:mm:ss"),o={userKey:l.value.token,pk_anlaxy_syllabus_user:a.value.pk_anlaxy_syllabus_user,phone_code:l.value.client_id||"",sign_out_type:s,u_end_time:i,lesson_change_list:a.value.pk_anlaxy_syllabus_user,lesson_change_type:"0",ask_leave_num:0,out_longitude:0,out_latitude:0,in_longitude:"0",in_latitude:"0",reviewscore:10,reviewcontent:"å¥½",sign_in_type:"2",u_begin_time:u,before_class_over_time:t.format("HH:mm"),late_time_length:0,late_num:0};try{const e=await d(o);if("1"===e.state){try{await oe("ç­¾é€€","zhkq_Click_SignOut",JSON.stringify(o),JSON.stringify(e),n,a.value.className)}catch(c){}const t=1===s?"æ—©é€€":"æ­£å¸¸ç­¾é€€";alert(`âœ… ç­¾é€€æˆåŠŸï¼\n\nè¯¾ç¨‹: ${a.value.className}\nç­¾é€€æ—¶é—´: ${i}\nçŠ¶æ€: ${t}`),window.location.reload()}else alert(`âš ï¸ ç­¾é€€å¤±è´¥\n\nstate: ${e.state}\nsing_result: ${e.sing_result}`)}catch(r){alert("âŒ ç­¾é€€å¤±è´¥\n\nç½‘ç»œé”™è¯¯æˆ–æœåŠ¡å™¨å¼‚å¸¸")}};return(e,l)=>{const n=g,r=p,c=k,d=S;return ee(),F("div",re,[K("div",ce,[K("div",de,[K("div",me,[K("span",ve,"ç¬¬"+q(a.value.classIndex)+"èŠ‚",1),K("span",fe,q(a.value.className),1)]),K("div",ge,[G(n,{type:o.value,effect:"dark",round:"",size:"small"},{default:P(()=>[Q(q(a.value.situation||s.value),1)]),_:1},8,["type"])])]),K("div",_e,[K("div",pe,[K("span",ye,[G(r,{color:"#667eea",class:"info-icon"},{default:P(()=>[G(W(_))]),_:1}),Q(" "+q(a.value.startTime.format("HH:mm"))+" - "+q(a.value.endTime.format("HH:mm")),1)]),l[1]||(l[1]=K("span",{class:"divider-inline"},"|",-1)),K("span",he,[G(r,{color:"#f093fb",class:"info-icon"},{default:P(()=>[G(W(y))]),_:1}),Q(" "+q(a.value.classRoom),1)]),l[2]||(l[2]=K("span",{class:"divider-inline"},"|",-1)),K("span",we,[G(r,{color:"#4facfe",class:"info-icon"},{default:P(()=>[G(W(h))]),_:1}),Q(" "+q(a.value.teacher.name)+" - "+q(a.value.teacher.id),1)])]),l[9]||(l[9]=K("div",{class:"divider"},null,-1)),K("div",be,[a.value.signInTime?(ee(),F("div",ke,[G(r,{color:"#00d2ff",class:"sign-icon"},{default:P(()=>[G(W(w))]),_:1}),K("span",Se,"ç­¾åˆ°: "+q(a.value.signInTime.format("HH:mm:ss")),1)])):u.value?(ee(),F("div",Ie,[G(r,{color:"#f093fb",class:"sign-icon"},{default:P(()=>[G(W(b))]),_:1}),l[4]||(l[4]=K("span",{class:"sign-label"},"ç­¾åˆ°:",-1)),G(c,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=e=>t.value=e),end:a.value.startTime.format("HH:mm"),start:a.value.shouldSignInTime.format("HH:mm"),class:"time-selector",placeholder:"é€‰æ‹©æ—¶é—´",size:"small",step:"00:01"},null,8,["modelValue","end","start"]),i.value?(ee(),X(d,{key:0,class:"sign-button",size:"small",type:"primary",onClick:m},{default:P(()=>[...l[3]||(l[3]=[Q(" ç­¾åˆ° ",-1)])]),_:1})):Z("",!0)])):(ee(),F("div",Ce,[G(r,{color:"#fa709a",class:"sign-icon"},{default:P(()=>[G(W(b))]),_:1}),l[6]||(l[6]=K("span",{class:"sign-text pending"},"æœªç­¾åˆ°",-1)),i.value&&!a.value.signInTime&&"å·²è¯·å‡"!==a.value.situation&&"å·²æ—·è¯¾"!==a.value.situation?(ee(),X(d,{key:0,class:"sign-button",size:"small",type:"primary",onClick:m},{default:P(()=>[...l[5]||(l[5]=[Q(" ç­¾åˆ° ",-1)])]),_:1})):Z("",!0)]))]),a.value.signInTime?(ee(),F("div",Oe,[a.value.signOutTime?(ee(),F("div",xe,[G(r,{color:"#00d2ff",class:"sign-icon"},{default:P(()=>[G(W(w))]),_:1}),K("span",Ne,"ç­¾é€€: "+q(a.value.signOutTime.format("HH:mm:ss")),1)])):(ee(),F("div",$e,[G(r,{color:"#fa709a",class:"sign-icon"},{default:P(()=>[G(W(b))]),_:1}),l[8]||(l[8]=K("span",{class:"sign-text pending"},"å¾…ç­¾é€€",-1)),"å·²è¯·å‡"!==a.value.situation&&"å·²æ—·è¯¾"!==a.value.situation?(ee(),X(d,{key:0,class:"sign-button",size:"small",type:"success",onClick:v},{default:P(()=>[...l[7]||(l[7]=[Q(" ç­¾é€€ ",-1)])]),_:1})):Z("",!0)]))])):Z("",!0)])])])}}}),[["__scopeId","data-v-78950dd8"]]),De={class:"class-list-container"},He=V(L({__name:"ClassContainer",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const a=Y(e,"modelValue");return(e,t)=>(ee(),F("div",De,[(ee(!0),F(ae,null,te(a.value,(e,t)=>(ee(),X(Te,{key:t,modelValue:a.value[t],"onUpdate:modelValue":e=>a.value[t]=e},null,8,["modelValue","onUpdate:modelValue"]))),128))]))}}),[["__scopeId","data-v-6ebf05f1"]]);function Me(){const e=z(!1),a=z(null);return{loading:e,error:a,execute:async function(t,l){e.value=!0,a.value=null;try{const e=await t();return l?.showSuccessMessage&&l?.successMessage&&C.success(l.successMessage),e}catch(n){return a.value=n,l?.silent||C.error(l?.errorMessage||"æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"),null}finally{e.value=!1}}}}const Ae="SA-ZHKQ-USERINFO";function Ue(e){try{const a=localStorage.getItem(e);return a?JSON.parse(a):null}catch(a){return null}}const Re="SA-CACHED-USER-INFO";function Ve(){const e=z(null);function a(){const e=Ue(Ae);return e?.user_code||null}function t(){const e=Ue(Ae);return e?.user_name||null}async function l(){try{const e=(await J.get("https://myip.ipip.net/json")).data;return e.data.ip+" | "+e.data.location[0]+"-"+e.data.location[1]+"-"+e.data.location[2]+"-"+e.data.location[4]}catch(e){return"è·å–IPåœ°å€å¤±è´¥"}}return{cachedInfo:e,getStudentId:a,getStudentName:t,getUserIp:l,loadUserInfo:async function(){const n=Ue(Re);if(n){if(Date.now()-n.timestamp<36e5)return e.value=n,n}const s=a(),i=t(),u=await l();if(!s||!i)return null;const o={studentId:s,studentName:i,userIp:u,timestamp:Date.now()};return function(e,a){try{localStorage.setItem(e,JSON.stringify(a))}catch(t){}}(Re,o),e.value=o,o},getCachedUserInfo:function(){if(e.value)return e.value;const a=Ue(Re);return a?(e.value=a,a):null},clearCache:function(){!function(e){try{localStorage.removeItem(e)}catch(a){}}(Re),e.value=null}}}const Be="SA-AC-SETTINGS";const Je={class:"dev-home-page"},Le={class:"page-header"},Ye={class:"build-info"},ze={class:"header-actions"},je={key:0,class:"user-info-card"},Ee={class:"user-info-content"},Fe={class:"info-line"},Ke={class:"info-text"},qe={class:"info-text"},Ge={class:"info-text"},Pe={class:"info-line"},Qe={class:"info-text"},Ze={class:"info-text"},We={class:"info-line"},Xe={class:"info-line"},ea={class:"bill-controls"},aa={key:0,class:"bill-table"},ta={key:1,class:"empty-state"},la={class:"qr-container"},na=["src"],sa={class:"qr-countdown"},ia={class:"user-details"},ua={class:"qr-actions"},oa={class:"air-conditioned-content"},ra={class:"dialog-actions"},ca={class:"course-container","element-loading-text":"æ­£åœ¨åŠ è½½è¯¾ç¨‹ä¿¡æ¯..."},da="SA-TOUR-COMPLETED2",ma=V(L({__name:"DevHome",setup(g){const _=Ve(),p=function(){const{execute:n}=Me(),s=z("åŠ è½½ä¸­..."),i=z("7æ—¥å†…æ²¡æœ‰æ¶ˆè´¹"),u=z([]),o=z(7),r=z("ç”¨æˆ·å"),c=z("ç­çº§"),d=z("å­¦æ ¡");function m(){const e=localStorage.getItem("SA-OC-USERINFO");if(!e)return null;try{return JSON.parse(e)}catch(a){return null}}async function v(){const e=localStorage.getItem("SA-OC-ACCOUNT");if(!e)return!1;try{const a=JSON.parse(e);if(!a.username||!a.password)return!1;const t=await l(a.username,a.password);if(200===t?.code){const e=structuredClone(t);return e.data&&(e.data.backUrl="",e.data.logoUrl=""),localStorage.setItem("SA-OC-USERINFO",JSON.stringify(e)),localStorage.setItem("SA-OC-TIMESTAMP",Date.now().toString()),!0}return!1}catch(a){return!1}}return{walletBalance:s,recentConsumption:i,billList:u,currentDays:o,userName:r,userClass:c,userId:d,getOCUserInfo:m,autoLogin:v,fetchWalletBalance:async function(e){const a=await n(async()=>{const e=m();if(!e?.data?.token)return s.value="æœªç™»å½•",null;const a=await t(e.data.token);if("æ‚¨çš„èº«ä»½ä¿¡æ¯å·²å¤±æ•ˆ,è¯·é‡æ–°ä»å¡åŒ…è¿›å…¥"===a.msg){if(await v()){const e=m();if(e?.data?.token)return await t(e.data.token)}return C.error("æ‚¨çš„èº«ä»½ä¿¡æ¯å·²å¤±æ•ˆ,è¯·é‡æ–°ç™»å½•"),localStorage.removeItem("SA-OC-USERINFO"),localStorage.removeItem("SA-OC-TIMESTAMP"),await B.push("/"),null}return a},{errorMessage:"è·å–é’±åŒ…ä½™é¢å¤±è´¥",silent:!0});if(void 0!==a?.data?.wallet0_amount){const t=(a.data.wallet0_amount/100).toFixed(2);if(s.value=`${t} å…ƒ`,e){const n=m();try{await oe("è·å–é’±åŒ…ä½™é¢","oc_Get_WalletBalance",String(n?.data?.token),JSON.stringify(a),e,`${t} å…ƒ`)}catch(l){}}}else s.value="è·å–å¤±è´¥"},fetchRecentConsumption:async function(e=7,t){const l=await n(async()=>{const t=m();return t?.data?.token?await a(1,1,e,t.data.token):(i.value="æœªç™»å½•",null)},{errorMessage:"è·å–æ¶ˆè´¹è®°å½•å¤±è´¥",silent:!0});if(!l)return void(i.value="æŸ¥è¯¢å¤±è´¥");if(400===l.code)return void(i.value=l.msg||"æ— æƒé™");let s;if(l.data?.all_count>0&&Array.isArray(l.data.list)){const e=l.data.list[0],a=(e.trade_amount??0)/100,t=e.desc||"",n={"ç”¨æ°´":"ğŸ¥¤","é¤":"ğŸ½ï¸","æ·‹æµ´":"ğŸš¿","å¾®ä¿¡å……å€¼":"ğŸ’³","å•†åœº":"ğŸ›ï¸","æ´—è¡£":"ğŸ§¼"},u=Object.entries(n).find(([e])=>t.includes(e))?.[1]||"";s=`${a.toFixed(2)}å…ƒ${u}`,i.value=s}else s=`è¿‘${e}å¤©æœªæ¶ˆè´¹`,i.value=s;if(t){const e=m();try{await oe("è·å–æœ€è¿‘æ¶ˆè´¹è®°å½•","oc_Get_RecentConsumption",String(e?.data?.token),JSON.stringify(l),t,s)}catch(u){}}},fetchBillList:async function(e,t){o.value=e;const l=await n(async()=>{const t=m();return t?.data?.token?await a(1,100,e,t.data.token):(C.warning("è¯·å…ˆç™»å½•ä¸€å¡é€šä»¥æŸ¥çœ‹è´¦å•"),null)},{errorMessage:"è·å–è´¦å•ä¿¡æ¯å¤±è´¥"});if(u.value=l?.data?.list||[],t&&l){const e=m();try{await oe("è·å–è´¦å•åˆ—è¡¨","oc_Get_BillList",String(e?.data?.token),JSON.stringify(l),t,`è·å–äº† ${u.value.length} æ¡è´¦å•è®°å½•`)}catch(s){}}},fetchUserInfo:async function(a){const t=await n(async()=>{const a=m();return a?.data?.token?await e(a.data.token):(C.warning("è¯·å…ˆç™»å½•ä¸€å¡é€šä»¥è·å–ç”¨æˆ·ä¿¡æ¯"),null)},{errorMessage:"è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥"});if(200===t?.code&&(r.value=t.data.name||"ç”¨æˆ·å",c.value=t.data.dept_name||"ç­çº§",d.value=t.data.school_name||"å­¦æ ¡",a)){const e=m();try{await oe("è·å–ç”¨æˆ·ä¿¡æ¯","oc_Get_UserInfo",String(e?.data?.token),JSON.stringify(t),a,`${r.value} - ${c.value}`)}catch(l){}}}}}(),y=function(){const{execute:e}=Me(),a=z(!1),t=z(""),l=z(10),s=z(!1),i=z(null);function u(){const e=localStorage.getItem("SA-OC-USERINFO");if(!e)return null;try{return JSON.parse(e)}catch(a){return null}}async function o(a){const l=await e(async()=>{const e=u();return e?.data?.token?await n(e.data.token):(C.warning("è¯·å…ˆç™»å½•ä¸€å¡é€šä»¥è·å–æ”¯ä»˜äºŒç»´ç "),null)},{errorMessage:"è·å–æ”¯ä»˜äºŒç»´ç å¤±è´¥"});if(l?.data?.code_info&&(t.value=l.data.code_info,a)){const e=u();try{await oe("è·å–æ”¯ä»˜äºŒç»´ç ","oc_Get_PayQRCode",String(e?.data?.token),JSON.stringify(l),a,"äºŒç»´ç å·²ç”Ÿæˆ")}catch(s){}}}function r(){null!==i.value&&(clearInterval(i.value),i.value=null),l.value=10,i.value=window.setInterval(()=>{l.value--,l.value<=0&&(o().then(()=>{}).catch(e=>{}),l.value=10)},1e3)}function c(){r()}function d(){null!==i.value&&(clearInterval(i.value),i.value=null),l.value=10}return E(a,e=>{e?le().then(()=>{c()}):d()}),{showDialog:a,qrCodeBase64:t,refreshCountdown:l,refreshing:s,fetchQRCode:o,manualRefresh:async function(){if(!s.value){s.value=!0;try{await o(),r(),C.success("äºŒç»´ç å·²åˆ·æ–°")}catch(e){C.error("åˆ·æ–°äºŒç»´ç å¤±è´¥")}finally{s.value=!1}}},initialize:async function(e){await o(e)},startAutoRefresh:c,stopAutoRefresh:d}}(),h=function(){const{execute:e}=Me(),a=z(!1),t=z("1"),l=z(""),n=z(""),r=z(""),c=z([]),d=z([]),m=z(""),v=z("ç‚¹å‡»è®¾ç½®å®¿èˆ");function f(){const e=localStorage.getItem("SA-OC-USERINFO");if(!e)return null;try{return JSON.parse(e)}catch(a){return null}}async function g(){const a=await e(async()=>{const e=f();return e?.data?.token?await o(e.data.token):(C.warning("è¯·å…ˆç™»å½•ä¸€å¡é€š"),null)},{errorMessage:"è·å–æ”¯ä»˜å•ä½å¤±è´¥"});200===a?.code&&a.data.list.length>0&&(l.value=a.data.list[0].area_name,t.value=a.data.list[0].area_id)}async function _(){const a=await e(async()=>{const e=f();return e?.data?.token?await u(e.data.token):(C.warning("è¯·å…ˆç™»å½•ä¸€å¡é€š"),null)},{errorMessage:"è·å–æ¥¼æ ‹åˆ—è¡¨å¤±è´¥"});200===a?.code&&a.data.list&&(c.value=a.data.list)}async function p(a){const t=await e(async()=>{const e=f();return e?.data?.token?await i(a,e.data.token):(C.warning("è¯·å…ˆç™»å½•ä¸€å¡é€š"),null)},{errorMessage:"è·å–æˆ¿é—´åˆ—è¡¨å¤±è´¥"});200===t?.code&&t.data?.list&&(d.value=t.data.list)}async function y(a){if(!n.value||!r.value)return void(m.value="");const t=await e(async()=>{const e=f();return e?.data?.token?await s(n.value,r.value,e.data.token):(C.warning("è¯·å…ˆç™»å½•ä¸€å¡é€š"),null)},{errorMessage:"è·å–ç©ºè°ƒä½™é¢å¤±è´¥"});if(200===t?.code&&t.data?.balance&&(m.value=t.data.balance,v.value=t.data.balance,a)){const e=f();try{await oe("è·å–ç©ºè°ƒä½™é¢","oc_Get_ACBalance",String(e?.data?.token),JSON.stringify(t),a,`æ¥¼æ ‹${n.value} æˆ¿é—´${r.value}: ${m.value}`)}catch(l){}}}function h(){return!(!n.value||!r.value)}async function w(e){try{const a=localStorage.getItem(Be);if(!a)return;const s=JSON.parse(a);t.value=s.areaId||"1",l.value=s.areaName||"",n.value=s.buildingId||"",r.value=s.roomId||"",n.value&&await p(n.value),h()&&await y(e)}catch(a){}}return{showDialog:a,selectedAreaId:t,selectedAreaName:l,selectedBuildingId:n,selectedRoomId:r,buildingList:c,roomList:d,balance:m,balanceDisplay:v,loadPaymentUnits:g,loadBuildingList:_,loadRoomList:p,loadBalance:y,onBuildingChange:async function(e){r.value="",d.value=[],m.value="",e&&await p(e)},onRoomChange:async function(){await y()},validateSettings:h,saveSettings:function(){if(!h())return void C.warning("è¯·å…ˆé€‰æ‹©æ¥¼æ ‹å’Œæˆ¿é—´");const e={areaId:t.value,areaName:l.value,buildingId:n.value,roomId:r.value};localStorage.setItem(Be,JSON.stringify(e)),C.success("ç©ºè°ƒè®¾ç½®å·²ä¿å­˜")},loadSavedSettings:w,initialize:async function(e){await g(),await _(),await w(e)}}}(),w={signIn:async function(e,a){const t=await c(e);if(a)try{await oe("è¯¾ç¨‹ç­¾åˆ°","ZHKQ_SignIn",e.userKey,JSON.stringify(t),a,`ç­¾åˆ°ç±»å‹: ${e.sign_in_type}, æ—¶é—´: ${e.u_begin_time}`)}catch(l){}return t},signOut:async function(e,a){const t=await d(e);if(a)try{await oe("è¯¾ç¨‹ç­¾é€€","ZHKQ_SignOut",e.userKey,JSON.stringify(t),a,`ç­¾é€€ç±»å‹: ${e.sign_out_type}, æ—¶é—´: ${e.u_end_time}`)}catch(l){}return t},getDaySignList:async function(e,a){const t=await v(e);if(a)try{await oe("è·å–ç­¾åˆ°è®°å½•","ZHKQ_GetDaySignList",e.userKey,JSON.stringify(t),a,`æ—¥æœŸ: ${e.date}, è®°å½•æ•°: ${t.sign_record_list?.length||0}`)}catch(l){}return t},getDayCourseList:async function(e,a){const t=await m(e);if(a)try{await oe("è·å–è¯¾ç¨‹åˆ—è¡¨","ZHKQ_GetDayCourseList",e.userKey,JSON.stringify(t),a,`æ—¥æœŸ: ${e.date}, è¯¾ç¨‹æ•°: ${t.sourcelist?.length||0}`)}catch(l){}return t}},b=z(!1),k=z("true"===localStorage.getItem(da)),I=z(null),V=z(null),J=z(null),L=z(null);E(b,e=>{e||(localStorage.setItem(da,"true"),k.value=!0)});const Y=z(!1),ue=[{label:"1å¤©",value:1},{label:"7å¤©",value:7},{label:"14å¤©",value:14},{label:"1ä¸ªæœˆ",value:30}],re=e=>`${(e.trade_amount/100).toFixed(2)} å…ƒ`,ce=z(null),de=z(!1),me=z("2025-11-13 16:50:31"),ve=z("f7ede28b"),fe=z("f7ede28b9359420e4cf1d4e99f98968f6d992b52"),ge=z("åˆå¹¶æ‹‰å–è¯·æ±‚ #33"),_e=z("https://github.com/Dongyifengs/SmartAttendance"),pe=()=>{null!==ce.value&&(clearTimeout(ce.value),ce.value=null),de.value=!1,ce.value=window.setTimeout(()=>{de.value=!0,C({message:`æäº¤è®°å½•: ${ge.value}`,type:"info",duration:5e3,showClose:!0})},800)},ye=()=>{null!==ce.value&&(clearTimeout(ce.value),ce.value=null),setTimeout(()=>{de.value=!1},100)},he=()=>{const e=fe.value&&"å¼€å‘ä¸­"!==fe.value?`${_e.value}/commit/${fe.value}`:"#";e&&"#"!==e&&window.open(e,"_blank")},we=()=>{localStorage.clear(),B.push("/")},be=()=>{B.push("/home")},ke=r(),Se=z([]),Ie=z(!0),Ce=f().format("YYYY-MM-DD"),Oe=j(()=>{if(!ke.value?.client_id)return"";return ke.value.client_id.split(",")[0].replace(/^uuid_/,"")}),xe=(e,a)=>"1"===e.absent_num?"å·²æ—·è¯¾":"1"===e.ask_leave_num?"å·²è¯·å‡":"è¿Ÿåˆ°"===a?"è¿Ÿåˆ°":"æ—©é€€"===a?"æ—©é€€":null;async function Ne(){if(ke.value){Ie.value=!0;try{const[e,a]=await Promise.all([w.getDaySignList({date:Ce,userKey:ke.value.token},fe.value),w.getDayCourseList({date:Ce,userKey:ke.value.token},fe.value)]),t=e?.sign_record_list??[],l=a?.sourcelist??[],n=new Map(t.map(e=>[e.pk_lesson,e])),s=l.map((e,a)=>{const t=n.get(e.pk_anlaxy_lesson);if(t){const l=((e,a)=>{const t=f(),l=f(`${e.lesson_date} ${e.begin_time}`),n=f(`${e.lesson_date} ${e.end_time}`),s=!(!a.u_begin_time||""===a.u_begin_time),i=!(!a.u_end_time||""===a.u_end_time),u=s?f(a.u_begin_time):null,o=i?f(a.u_end_time):null;return"1"===a.absent_num||"1"===a.ask_leave_num?null:s&&u&&u.isAfter(l)?i?o&&o.isBefore(n)?"æ—©é€€":"å·²ç­¾é€€":"è¿Ÿåˆ°":i&&o&&o.isBefore(n)?"æ—©é€€":i?"å·²ç­¾é€€":s?"å·²ç­¾åˆ°":!s&&t.isAfter(l)?"è¿Ÿåˆ°":"æœªç­¾åˆ°"})(e,t);return{classIndex:a+1,className:e.lesson_name,startTime:f(`${e.lesson_date} ${e.begin_time}`),endTime:f(`${e.lesson_date} ${e.end_time}`),signInTime:t.u_begin_time?f(t.u_begin_time):null,signOutTime:t.u_end_time?f(t.u_end_time):null,shouldSignInTime:f(`${t.lesson_date} ${t.before_class_time}`),shouldSignOutTime:f(`${t.lesson_date} ${t.after_class_over_time}`),classRoom:e.class_room_name,teacher:{name:e.teacher_name,id:Number.parseInt(e.teacher_id)},situation:xe(t,l),computedStatus:l,pk_anlaxy_syllabus_user:t.pk_anlaxy_syllabus_user,lessonDate:e.lesson_date}}return null}).filter(e=>!!e);Se.value=s.sort((e,a)=>{const t=e=>"å·²è¯·å‡"===e.situation||"å·²æ—·è¯¾"===e.situation?3:e.signInTime&&e.signOutTime?2:1;return t(e)-t(a)})}catch(e){}finally{Ie.value=!1}}}return ne(async()=>{try{await _.loadUserInfo(),await Ne(),await Promise.all([p.fetchWalletBalance(fe.value),p.fetchRecentConsumption(7,fe.value),p.fetchBillList(7,fe.value),p.fetchUserInfo(fe.value)]),await y.initialize(fe.value),await h.initialize(fe.value),await le(),(()=>{const e="true"===localStorage.getItem(da);return k.value=e,e})()||(b.value=!0)}catch(e){}}),se(()=>{y.stopAutoRefresh(),null!==ce.value&&(clearTimeout(ce.value),ce.value=null)}),(e,a)=>{const t=S,l=T,n=$,s=O,i=M,u=H,o=U,r=A,c=D,d=R,m=N,v=x;return ee(),F("div",Je,[K("div",Le,[K("div",Ye,[K("span",{class:"build-time",title:"é•¿æŒ‰æŸ¥çœ‹æäº¤è®°å½•",onMousedown:pe,onMouseleave:ye,onMouseup:ye,onTouchcancel:ye,onTouchend:ye,onTouchstart:pe}," ç¼–è¯‘æ—¶é—´ï¼š"+q(me.value),33),K("span",{class:"hash-link",onClick:he},q(ve.value),1)]),K("div",ze,[G(t,{onClick:we},{default:P(()=>[...a[12]||(a[12]=[Q("é€€å‡ºç™»å½•",-1)])]),_:1}),G(t,{onClick:be},{default:P(()=>[...a[13]||(a[13]=[Q("è¿”å›",-1)])]),_:1})])]),W(ke)?(ee(),F("div",je,[a[19]||(a[19]=K("div",{class:"user-info-header"},[K("h3",null,"ä¸ªäººä¿¡æ¯")],-1)),K("div",Ee,[K("div",Fe,[K("span",Ke,"å§“å: "+q(W(ke).user_name),1),a[14]||(a[14]=K("span",{class:"divider"},"|",-1)),K("span",qe,q(W(ke).birthday||"æœªè®¾ç½®ç”Ÿæ—¥"),1),a[15]||(a[15]=K("span",{class:"divider"},"|",-1)),K("span",Ge,"å­¦å·: "+q(W(ke).user_code),1)]),K("div",Pe,[K("span",Qe,"ç­¾åˆ°æ—¥æœŸ: "+q(W(Ce)),1),a[16]||(a[16]=K("span",{class:"divider"},"|",-1)),K("span",Ze,"è®¾å¤‡ID: "+q(Oe.value),1)]),K("div",We,[K("span",{ref_key:"walletBalanceRef",ref:I,class:"info-text clickable"}," é’±åŒ…ä½™é¢: "+q(W(p).walletBalance.value),513),a[17]||(a[17]=K("span",{class:"divider"},"|",-1)),K("span",{ref_key:"airConditioningBalanceRef",ref:V,class:"info-text clickable",onClick:a[0]||(a[0]=e=>W(h).showDialog.value=!0)}," ç©ºè°ƒä½™é¢: "+q(W(h).balanceDisplay.value),513)]),K("div",Xe,[K("span",{ref_key:"qrCodePaymentFunction",ref:L,class:"info-text clickable",onClick:a[1]||(a[1]=e=>W(y).showDialog.value=!0)}," ä¸ªäººä»˜æ¬¾ç  ",512),a[18]||(a[18]=K("span",{class:"divider"},"|",-1)),K("span",{ref_key:"recentConsumptionRef",ref:J,class:"info-text clickable",onClick:a[2]||(a[2]=e=>Y.value=!0)}," æœ€æ–°æ¶ˆè´¹: "+q(W(p).recentConsumption.value),513)])])])):Z("",!0),G(s,{modelValue:Y.value,"onUpdate:modelValue":a[3]||(a[3]=e=>Y.value=e),"close-on-click-modal":!0,class:"bill-dialog",title:"è´¦å•è¯¦æƒ…",width:"400px"},{default:P(()=>[K("div",ea,[(ee(),F(ae,null,te(ue,e=>G(t,{key:e.value,type:e.value===W(p).currentDays.value?"primary":"default",size:"small",onClick:a=>W(p).fetchBillList(e.value)},{default:P(()=>[Q(q(e.label),1)]),_:2},1032,["type","onClick"])),64))]),W(p).billList.value.length?(ee(),F("div",aa,[G(n,{data:W(p).billList.value,size:"small",style:{width:"100%"}},{default:P(()=>[G(l,{align:"center",label:"æ—¶é—´","min-width":"35%",prop:"trade_time"}),G(l,{align:"center",label:"è¯´æ˜","min-width":"33%",prop:"desc"}),G(l,{formatter:re,align:"center",label:"é‡‘é¢","min-width":"32%",prop:"trade_amount"})]),_:1},8,["data"])])):(ee(),F("div",ta,"æš‚æ— è´¦å•æ•°æ®"))]),_:1},8,["modelValue"]),G(s,{modelValue:W(y).showDialog.value,"onUpdate:modelValue":a[5]||(a[5]=e=>W(y).showDialog.value=e),"close-on-click-modal":!0,class:"pay-dialog",title:"æ”¯ä»˜äºŒç»´ç ",width:"400px"},{default:P(()=>[K("div",la,[K("img",{src:W(y).qrCodeBase64.value,alt:"æ”¯ä»˜äºŒç»´ç ",class:"qr-code"},null,8,na),K("div",sa,"äºŒç»´ç  "+q(W(y).refreshCountdown.value)+" ç§’åè‡ªåŠ¨åˆ·æ–°",1)]),K("div",ia,q(W(p).userClass.value)+" | "+q(W(p).userName.value)+" | "+q(W(p).userId.value),1),a[20]||(a[20]=K("div",{class:"qr-hint"},"è¯·ä½¿ç”¨æ ¡å›­ä¸€å¡é€šAppæ‰«ç æ”¯ä»˜",-1)),K("div",ua,[G(t,{loading:W(y).refreshing.value,type:"primary",onClick:a[4]||(a[4]=e=>W(y).manualRefresh())},{default:P(()=>[Q(q(W(y).refreshing.value?"åˆ·æ–°ä¸­...":"ç«‹å³åˆ·æ–°äºŒç»´ç "),1)]),_:1},8,["loading"])])]),_:1},8,["modelValue"]),G(s,{modelValue:W(h).showDialog.value,"onUpdate:modelValue":a[9]||(a[9]=e=>W(h).showDialog.value=e),"close-on-click-modal":!0,class:"air-conditioned-dialog",title:"ç©ºè°ƒè®¾ç½®ä¸ç¼´è´¹",width:"400px"},{default:P(()=>[K("div",oa,[G(c,{"label-width":"100px"},{default:P(()=>[G(u,{label:"ç¼´è´¹å•ä½"},{default:P(()=>[G(i,null,{default:P(()=>[Q(q(W(h).selectedAreaName.value||"åŠ è½½ä¸­..."),1)]),_:1})]),_:1}),G(u,{label:"æ¥¼æ ‹å·"},{default:P(()=>[G(r,{modelValue:W(h).selectedBuildingId.value,"onUpdate:modelValue":a[6]||(a[6]=e=>W(h).selectedBuildingId.value=e),clearable:"",filterable:"",placeholder:"è¯·é€‰æ‹©æ¥¼æ ‹å·",style:{width:"100%"},onChange:W(h).onBuildingChange},{default:P(()=>[(ee(!0),F(ae,null,te(W(h).buildingList.value,e=>(ee(),X(o,{key:e.build_id,label:e.build_name,value:e.build_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),G(u,{label:"æˆ¿é—´å·"},{default:P(()=>[G(r,{modelValue:W(h).selectedRoomId.value,"onUpdate:modelValue":a[7]||(a[7]=e=>W(h).selectedRoomId.value=e),disabled:!W(h).selectedBuildingId.value,clearable:"",filterable:"",placeholder:"è¯·å…ˆé€‰æ‹©æ¥¼æ ‹å·",style:{width:"100%"},onChange:W(h).onRoomChange},{default:P(()=>[(ee(!0),F(ae,null,te(W(h).roomList.value,e=>(ee(),X(o,{key:e.room_id,label:e.room_name,value:e.room_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled","onChange"])]),_:1}),G(u,{label:"ç©ºè°ƒä½™é¢"},{default:P(()=>[W(h).balance.value?(ee(),X(i,{key:0,size:"large",type:"primary"},{default:P(()=>[Q(q(W(h).balance.value),1)]),_:1})):(ee(),X(i,{key:1},{default:P(()=>[...a[21]||(a[21]=[Q("è¯·å…ˆé€‰æ‹©æ¥¼æ ‹å’Œæˆ¿é—´",-1)])]),_:1}))]),_:1})]),_:1}),K("div",ra,[G(t,{type:"primary",onClick:a[8]||(a[8]=e=>W(h).saveSettings())},{default:P(()=>[...a[22]||(a[22]=[Q("ä¿å­˜è®¾ç½®",-1)])]),_:1})])])]),_:1},8,["modelValue"]),ie((ee(),F("div",ca,[G(He,{modelValue:Se.value,"onUpdate:modelValue":a[10]||(a[10]=e=>Se.value=e)},null,8,["modelValue"])])),[[v,Ie.value]]),k.value?Z("",!0):(ee(),X(m,{key:1,modelValue:b.value,"onUpdate:modelValue":a[11]||(a[11]=e=>b.value=e),mask:{color:"rgba(0, 0, 0, 0.5)",style:{zIndex:3e3}},"z-index":3001},{default:P(()=>[G(d,{"next-button-props":{children:"ä¸‹ä¸€æ­¥"},target:I.value,description:"ç™»å½•ä¸€å¡é€šå°±èƒ½çœ‹è§é’±åŒ…çš„ä½™é¢",title:"é’±åŒ…ä½™é¢"},null,8,["target"]),G(d,{"next-button-props":{children:"ä¸‹ä¸€æ­¥"},"prev-button-props":{children:"ä¸Šä¸€æ­¥"},target:V.value,description:"ç‚¹å‡»å¯ä»¥æŸ¥çœ‹å’Œè®¾ç½®ç©ºè°ƒä½™é¢ã€‚é€‰æ‹©æ¥¼æ ‹å·å’Œæˆ¿é—´å·åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŸ¥è¯¢ç©ºè°ƒä½™é¢å¹¶ä¿å­˜è®¾ç½®",title:"ç©ºè°ƒä½™é¢"},null,8,["target"]),G(d,{"next-button-props":{children:"ä¸‹ä¸€æ­¥"},"prev-button-props":{children:"ä¸Šä¸€æ­¥"},target:J.value,description:"é»˜è®¤æ˜¾ç¤ºæœ€è¿‘7å¤©çš„æ¶ˆè´¹è®°å½•ï¼Œç‚¹å‡»ä¹‹åä¼šæ˜¾ç¤ºè¯¦ç»†æ¨¡å¼ï¼Œå¯ä»¥è‡ªå·±é€‰æ‹©æ—¶é—´èŒƒå›´",title:"æœ€è¿‘æ¶ˆè´¹è®°å½•"},null,8,["target"]),G(d,{"next-button-props":{children:"å®Œæˆ"},"prev-button-props":{children:"ä¸Šä¸€æ­¥"},target:L.value,description:"ç‚¹å‡»æ˜¾ç¤ºä¸€å¡é€šäºŒç»´ç æ”¯ä»˜åŠŸèƒ½ï¼Œæ”¯æŒè‡ªåŠ¨åˆ·æ–°å’Œæ‰‹åŠ¨åˆ·æ–°",title:"äºŒç»´ç æ”¯ä»˜åŠŸèƒ½"},null,8,["target"])]),_:1},8,["modelValue"]))])}}}),[["__scopeId","data-v-131fc70d"]]);export{ma as default};
