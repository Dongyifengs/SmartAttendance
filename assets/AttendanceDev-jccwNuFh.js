import{X as V}from"./el-button-BAn6I0Bg.js";import{c as M,E as F,a as P,b as z}from"./el-table-column-ChimdN4M.js";import{d as O}from"./el-popper-DhYhDswn.js";import{p as $,q as j,r as K,s as H,v as J}from"./index-C9ZLzzEa.js";import{E as Q}from"./el-text-8Htao5Mp.js";import{d as Z,r as f,c as q,x as L,j as S,e as n,a as p,g as X,m as a,w as d,F as A,P as N,k as h,l as w,o as r,_ as G}from"./index-8iNL8t5a.js";import"./raf-QmIwOS94.js";const W={class:"attendance-page"},ee={class:"header"},te={class:"user-info"},ae={class:"mt-3"},se={class:"mt-5"},le=Z({__name:"AttendanceDev",setup(oe){const C=f(""),m=f(""),k=f([]),g=f(!1),b=f({1:[],2:[],3:[],4:[],5:[]}),y={1:"正常",2:"迟到",3:"早退",4:"旷课",5:"请假"},u=f(["2020-01-01",O().format("YYYY-MM-DD")]),D=()=>{try{const e=localStorage.getItem("SA-ZHKQ-USERINFO");return e&&JSON.parse(e).token||""}catch{return""}},x=()=>{try{const e=localStorage.getItem("SA-ZHKQ-USERINFO");return e&&JSON.parse(e).pk_user||""}catch{return""}},I=(e,t,o)=>o===1?"是":"否",R=()=>g.value=!g.value,U=q(()=>{const e=k.value;return g.value||e.length<=4?e:[...e.slice(0,2),...e.slice(-2)]}),T=async()=>{const e=D();if(e)try{const o=(await $(e)).class_list?.[0];if(!o)return;C.value=o.class_name,m.value=o.class_id;const i=await j(e,o.class_id);k.value=i.group_members||[]}catch(t){console.error("加载班级或学生失败",t)}},Y=async e=>{try{const t=D(),o=x();if(!t||!o||!m.value)return;const i=await K(t,o,m.value,e,u.value[0],u.value[1]);i.list&&Array.isArray(i.list)&&(b.value[e]=await Promise.all(i.list.map(async c=>{let s=0,_="";try{s=(await H(t,m.value,c.pk_lesson,o,e,u.value[0],u.value[1])).list?.[0]?.totalNum||0;const l=await J(t,m.value,c.pk_lesson,o,e,u.value[0],u.value[1]);l.state==="1"&&l.data?.record_list?.length&&(_=l.data.record_list.map(B=>B.record_date).join("、"))}catch(v){console.error(`获取课程 ${c.lesson_name} 考勤详情失败`,v)}return{lesson_name:c.lesson_name,teacher_name:c.teacher_name,status:y[e]||"未知",totalNum:s,pk_lesson:c.pk_lesson,recordDates:_}})))}catch(t){console.error(`获取${y[e]}课程失败`,t)}},E=async()=>{for(const e of["1","2","3","4","5"])await Y(e)};return L(async()=>{await T(),await E()}),(e,t)=>{const o=Q,i=V,c=M,s=P,_=F,v=z;return r(),S("div",W,[n("div",ee,[a(o,null,{default:d(()=>[...t[2]||(t[2]=[h("AttendanceDev - 考勤查询页面",-1)])]),_:1}),a(i,{class:"ml-2",type:"default",onClick:t[0]||(t[0]=l=>e.$router.back())},{default:d(()=>[...t[3]||(t[3]=[h("返回上一页",-1)])]),_:1})]),n("div",te,[a(o,null,{default:d(()=>[h("当前用户班级："+w(C.value||"加载中..."),1)]),_:1}),t[4]||(t[4]=n("br",null,null,-1)),a(o,null,{default:d(()=>[h("当前用户班级ID："+w(m.value||"加载中..."),1)]),_:1}),t[5]||(t[5]=n("br",null,null,-1))]),n("div",ae,[a(c,{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=l=>u.value=l),"end-placeholder":"结束日期",format:"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期",type:"daterange"},null,8,["modelValue"]),a(i,{class:"ml-2",type:"primary",onClick:E},{default:d(()=>[...t[6]||(t[6]=[h("查询",-1)])]),_:1})]),k.value.length>4?(r(),p(i,{key:0,class:"mt-3 mb-2",size:"small",type:"primary",onClick:R},{default:d(()=>[h(w(g.value?"收起":"显示全部"),1)]),_:1})):X("",!0),k.value.length?(r(),p(_,{key:1,data:U.value,border:"",size:"small",stripe:"",style:{width:"100%"}},{default:d(()=>[a(s,{label:"学号",prop:"user_code",width:"120"}),a(s,{label:"姓名",prop:"user_name",width:"100"}),a(s,{label:"EAS ID","min-width":"200",prop:"easid"}),a(s,{label:"UserPK","min-width":"200",prop:"userpk"}),a(s,{formatter:I,label:"是否好友",prop:"is_friends",width:"100"}),a(s,{label:"性别",prop:"sex",width:"80"})]),_:1},8,["data"])):(r(),p(v,{key:2,class:"mt-5",description:"暂无学生信息"})),n("div",se,[(r(),S(A,null,N(["1","4","5"],l=>n("div",{key:l,class:"course-table"},[n("div",null,w(y[l])+"课程：",1),b.value[l].length?(r(),p(_,{key:0,data:b.value[l],border:"",size:"small",stripe:"",style:{width:"100%","margin-top":"5px"}},{default:d(()=>[a(s,{label:"课程名称","min-width":"200",prop:"lesson_name"}),a(s,{label:"教师名称","min-width":"150",prop:"teacher_name"}),a(s,{label:"考勤状态",prop:"status",width:"100"}),a(s,{label:"次数",prop:"totalNum",width:"80"}),a(s,{label:"日期","min-width":"220",prop:"recordDates"})]),_:2},1032,["data"])):(r(),p(v,{key:1,class:"mt-2",description:"暂无课程"}))])),64)),(r(),S(A,null,N(["2","3"],l=>n("div",{key:l,class:"course-table"},[n("div",null,w(y[l])+"课程：",1),b.value[l].length?(r(),p(_,{key:0,data:b.value[l],border:"",size:"small",stripe:"",style:{width:"100%","margin-top":"5px"}},{default:d(()=>[a(s,{label:"课程名称","min-width":"200",prop:"lesson_name"}),a(s,{label:"教师名称","min-width":"150",prop:"teacher_name"}),a(s,{label:"考勤状态",prop:"status",width:"100"}),a(s,{label:"次数",prop:"totalNum",width:"80"}),a(s,{label:"日期","min-width":"220",prop:"recordDates"})]),_:2},1032,["data"])):(r(),p(v,{key:1,class:"mt-2",description:"暂无课程"}))])),64))])])}}}),me=G(le,[["__scopeId","data-v-57615408"]]);export{me as default};
